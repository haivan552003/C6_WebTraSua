@page "/register"
@layout EmptyLayout
@inject NavigationManager nv

<body>
    <header>
        <!-- place navbar here -->
    </header>
    <main>
        <div class="wrapper">
            <EditForm Model="registerData" FormName="register" OnValidSubmit="HandleValidSubmit" OnInvalidSubmit="HandleInvalidSubmit">
                <DataAnnotationsValidator />
                <h1>Đăng Ký</h1>
                <div class="input-box">
                    <InputText type="text" @bind-Value="registerData.Name" placeholder="Họ và tên" /> <i class='bx bx-rename'></i>
                    <div class="text-danger ps-3">
                        <ValidationMessage For="()=>registerData.Name"></ValidationMessage>
                    </div>
                </div>
                <div class="input-box">
                    <InputText type="text" @bind-Value="registerData.UserName" placeholder="Tên đăng nhập" /> <i class='bx bx-child'></i>
                    <div class="text-danger ps-3">
                        <ValidationMessage For="()=>registerData.UserName"></ValidationMessage>
                    </div>
                </div>
                <div class="input-box">
                    <InputText type="password" @bind-Value="registerData.PassWord" placeholder="Mật khẩu" /> <i class='bx bxs-lock-alt'></i>
                    <div class="text-danger ps-3">
                        <ValidationMessage For="()=>registerData.PassWord"></ValidationMessage>
                    </div>
                </div>
                <div class="input-box">
                    <InputText type="password" @bind-Value="registerData.RePass" placeholder="Nhập lại mật khẩu" /> <i class='bx bxs-lock'></i>
                    <div class="text-danger ps-3">
                        <ValidationMessage For="()=>registerData.RePass"></ValidationMessage>
                    </div>
                </div>
                <button type="submit" class="btn">Đăng ký</button>

                <div class="register-link">
                    <label> <input type="checkbox"> Tôi chấp nhận điều khoản </label>
                    <a href="#"></a>
                </div>
            </EditForm>
        </div>
    </main>
    <footer>
        <!-- place footer here -->
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
            integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+"
            crossorigin="anonymous"></script>
</body>

@code {
    string url = "http://localhost:20714/api/Users";

    public UserRegister registerData = new UserRegister();
    UserRegister recievedRegister;

    public string FormSubmitMessage { get; set; } = null;

    public async Task HandleValidSubmit()
    {
        recievedRegister = new UserRegister();
        using (var httpClient = new HttpClient())
        {
            StringContent content = new StringContent(JsonConvert.SerializeObject(registerData), Encoding.UTF8, "application/json");

            using (var response = await httpClient.PostAsync(url, content))
            {
                string apiResponse = await response.Content.ReadAsStringAsync();
                recievedRegister = JsonConvert.DeserializeObject<UserRegister>(apiResponse);
                if (response.IsSuccessStatusCode)
                {
                    FormSubmitMessage = "Đăng ký thành công";
                    nv.NavigateTo("/");
                }
                else
                {
                    FormSubmitMessage = "Đăng ký thất bại";
                }
            }
        }
        FormSubmitMessage = "Đăng ký thành công";
    }

    public void HandleInvalidSubmit() => FormSubmitMessage = "Đăng ký thất bại";
}
